<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Gaming time recorder</title>
  <style type="text/css">
  	table {
	    border-collapse: collapse;
	}
  	
  	table, th, td {
  		border: 1px solid black;
  	}
  </style>
</head>
<body>
<h1>Ausgabe der Spielzeiten</h1>
<button id="list">Aktualisieren</button>
<button id="csv">Als .csv herunterladen</button>
<p>
<hr>
<div id="result">
</div>

<script src="//code.jquery.com/jquery-1.11.3.min.js"></script>
<script>
list = function() {
	$.get("/rest/protected/list")
	.done( function( data ) {
		var result = "<ul>";
		
		for (i in data.entries) {
			var client = data.entries[i];
			
			result += "<li>" + client.clientId + " (" + client.duration.$numberLong + " min)<ul>";
			
			for (j in client.days) {
				var day = client.days[j];
				result += "<li>" + day.day + " (" + day.duration.$numberLong + " min) <ul>";
				
				for (k in day.sessions) {
					var session = day.sessions[k];
					result += "<li>" + session.duration.$numberLong + " min (" + 
					                   new Date(parseInt(session.start.$numberLong)) + " - " + 
					                   new Date(parseInt(session.end.$numberLong)) + ")";
				}
				result += "</ul></li>";
			}
			
			result += "</ul></li>";
		}
		
		result += "</ul>";
		$( "#result" ).html( result );
	});
};

$("#list").on("click", function(event) { 
	list(); 
});

$("#csv").on("click", function(event) {
	window.location = "/rest/protected/csv";
});

$( document ).ready(list);
</script>
</body>
</html>
